/**
 * DNS Lookup - KYOKO MD Pentest Feature
 * DNS record lookup
 * Developer: ZetaGo-Aurum
 */

const dns = require('dns').promises;

const pluginConfig = {
    name: 'dnslookup',
    alias: ['dns', 'nslookup', 'dig'],
    category: 'pentest',
    description: 'DNS record lookup',
    usage: '.dnslookup <domain>',
    example: '.dnslookup example.com',
    isOwner: false,
    isPremium: false,
    isGroup: false,
    isPrivate: false,
    cooldown: 5,
    limit: 0,
    isEnabled: true
};

async function handler(m, { sock }) {
    const domain = m.text?.trim()?.toLowerCase();
    
    if (!domain) {
        return m.reply(`‚ùå Format: .dnslookup <domain>\n\nContoh: .dnslookup example.com`);
    }
    
    // Validate domain
    if (!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,}$/.test(domain)) {
        return m.reply(`‚ùå Invalid domain format!`);
    }
    
    await m.reply(`üîç *·¥Ö…¥Íú±  ü·¥è·¥è·¥ã·¥ú·¥ò*\n\n‚è≥ Resolving ${domain}...`);
    
    try {
        let txt = `üîç *·¥Ö…¥Íú±  Ä·¥á·¥Ñ·¥è Ä·¥ÖÍú±*\n\n`;
        txt += `üåê Domain: \`${domain}\`\n\n`;
        
        // A Records
        try {
            const aRecords = await dns.resolve4(domain);
            txt += `üìå *A Records*\n`;
            aRecords.forEach(ip => txt += `  ‚ó¶ ${ip}\n`);
            txt += `\n`;
        } catch (e) {
            txt += `üìå A Records: -\n\n`;
        }
        
        // AAAA Records (IPv6)
        try {
            const aaaaRecords = await dns.resolve6(domain);
            txt += `üìå *AAAA Records*\n`;
            aaaaRecords.slice(0, 3).forEach(ip => txt += `  ‚ó¶ ${ip}\n`);
            txt += `\n`;
        } catch (e) {
            // No IPv6
        }
        
        // MX Records
        try {
            const mxRecords = await dns.resolveMx(domain);
            txt += `üìß *MX Records*\n`;
            mxRecords.slice(0, 5).forEach(mx => txt += `  ‚ó¶ ${mx.exchange} (Pri: ${mx.priority})\n`);
            txt += `\n`;
        } catch (e) {}
        
        // NS Records
        try {
            const nsRecords = await dns.resolveNs(domain);
            txt += `üñ•Ô∏è *NS Records*\n`;
            nsRecords.forEach(ns => txt += `  ‚ó¶ ${ns}\n`);
            txt += `\n`;
        } catch (e) {}
        
        // TXT Records
        try {
            const txtRecords = await dns.resolveTxt(domain);
            txt += `üìù *TXT Records*\n`;
            txtRecords.slice(0, 3).forEach(record => {
                const val = record.join('').substring(0, 60);
                txt += `  ‚ó¶ ${val}${record.join('').length > 60 ? '...' : ''}\n`;
            });
        } catch (e) {}
        
        await m.reply(txt);
        
    } catch (error) {
        await m.reply(`‚ùå DNS lookup gagal: ${error.message}`);
    }
}

module.exports = { config: pluginConfig, handler };
